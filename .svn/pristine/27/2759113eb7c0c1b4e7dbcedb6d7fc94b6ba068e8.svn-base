package info.san.biblio.app;

import info.san.biblio.app.command.handler.SerieCommandHandler;
import info.san.biblio.app.model.listener.SaisonListener;
import info.san.biblio.app.model.listener.SerieListener;

import java.io.File;

import org.axonframework.commandhandling.CommandBus;
import org.axonframework.commandhandling.SimpleCommandBus;
import org.axonframework.commandhandling.annotation.AnnotationCommandHandlerAdapter;
import org.axonframework.commandhandling.gateway.CommandGateway;
import org.axonframework.commandhandling.gateway.DefaultCommandGateway;
import org.axonframework.eventhandling.EventBus;
import org.axonframework.eventhandling.SimpleEventBus;
import org.axonframework.eventhandling.annotation.AnnotationEventListenerAdapter;
import org.axonframework.eventstore.EventStore;
import org.axonframework.eventstore.fs.FileSystemEventStore;
import org.axonframework.eventstore.fs.SimpleEventFileResolver;

public class AxonContext {

	private EventStore eventStore;

	private CommandBus commandBus;

	private CommandGateway commandGateway;

	private EventBus eventBus;

	private static final class Holder {
		private static final AxonContext INSTANCE = new AxonContext();
	}

	private AxonContext() {
		this.eventStore     = new FileSystemEventStore(new SimpleEventFileResolver(new File("./events")));
		this.commandBus     = new SimpleCommandBus();
		this.commandGateway = new DefaultCommandGateway(this.commandBus);
		this.eventBus       = new SimpleEventBus();

		AnnotationCommandHandlerAdapter.subscribe(new SerieCommandHandler(), this.commandBus);
		AnnotationEventListenerAdapter.subscribe(new SerieListener(), this.eventBus);
		AnnotationEventListenerAdapter.subscribe(new SaisonListener(), this.eventBus);
	}

	public static final AxonContext getInstance() {
		return Holder.INSTANCE;
	}

	public EventStore getEventStore() {
		return this.eventStore;
	}

	public CommandBus getCommandBus() {
		return this.commandBus;
	}

	public EventBus getEventBus() {
		return this.eventBus;
	}

	public CommandGateway getCommandGateway() {
		return this.commandGateway;
	}

}
